# block-canvas

на проекте используется версия node 18.10.0

## Правила для EsLint

В [этом файле](EsLint.md) есть вся необходимая информация по правилам, которые используются в проекте.

## Описание проекта. Текущее состояние.

Стек проекта:

- Vue 2
- FabricJs. [Ссылка на библиотеку здесь](http://fabricjs.com/)

Почему выбор был сделан в пользу этой библиотеки? Она предоставляет возможность обращаться к отдельным объектам. Из коробки имеется возможность масштабировать объект, зименять положение относительно своей оси, перемещать объект по области отображения.

Понимая специфику деятельности компании, пришел к выводу что это приложение должно симулировать конструктор блок-схем.

Исходя из требований в техзадании функционал приложения должен быть следующим:

- возможность добавлять на холст объекты с любым количеством "розеток" для соединения. В рамках этого ТЗ от 1 до 4. Но в будущем должно быть несколько типов объектов.
- при нажатии на "розетку" (событие нажатия кнопки мыши) объект должен становиться неподвижным пока не произойдет соединение с другой "розеткой". После этого объекты опять должны быть подвижны. А между ними должна появится линия. При перемещении любого из двух связанных обектов, линия соединения должна изменяться в соответствии с новым положение объектов
- Линии не должны проходить сквозь объекты. Они должны их огибать.
- При выборе объекта должна быть возможность его удалить, изменить масштаб, изменить количество "розеток"б если они есть.
- При перезагрузке приложения, состояние объектов должно сохраниться и отобразиться заново.

### Особенности реализации и проблемы, с которыми столкнулся в настоящий момент.

Инициализация библиотеки FabricJs происходит в жизненном цикле компонента mounted. Комопнент получает экземпляр нового инстанса canvas, сохраняет его в состоянии компонента и передает при каждом новом создании объекта. Таким образом у меня не получилось создать отдельный модуль в файле canvasUtils, где был бы доступен экземпляр canvas. Он доступен только внутри функций, которые там определены, в качестве одного из аргументов.

#### функция addNewElement

Вся верхнеуровневая логика приложения сконцентрирована в функции addNewElement. По-сути она определяет все основные слушатели, которые будут необходимы элементам.

Она принимает на вход экземпля canvas и объект с ключами, которые говорят о том, какие конкретно "розетки" в элементе должны быть отрисованы. В настооящий момент это listenerCircleMouseDown и listenerCircleMouseUp.

Я выбрал события нажатия кнопки мыши и ее отпускания в каждом элементе "розетки", т.к основной функционал для них я видел следующий:

- при нажатии кнопки элемент блокируется, сохраняем координаты "розетки", отслеживаем событие на холсте (canvas.on())
- при отпускании кнопки мыши снимаем слушатель на canvas, чтобы небыло утечки памяти.

#### Проблемы которые пока не смог решить.

1. При нажатии на кнопку мыши (событие mousedown) я не смог получить координаты целевого объекта. При прослушивании mousedown у canvas можно получит объект options. Меня интересуют 2 ключа : е и target. В ключе "e" можно получить общие параметры передвижения мыши относительно окна браузера или холста canvas. В ключе "target" можно получить объект холста, если мышь находится над ним. Над пустым холстом он имеет занчение null.
   В текущем состоянии проекта я это отследить не могу, т.к с момента нажатия кнопки мыши в target попадает значение обекта, над которым началось событие. Я не нашел способа отследить момент покидания области объекта (target: null) и появление курсора мыши над другим объектом (target: {...}). Это привело к тому, что при отпускании кнопки мыши, я не могу заблокировать добавлении линии соединения, если она не над областью розетки.

2. При отрисовке линии нужно каким-то образом связать с ней объект, из которого она начинается. Задача не решена. Примерное решение может быть следующим:

- нужно создасть в объекте, который отрисовал canvas, необходимое количество "точек привязки". В моем случае - это ключи line1 ... line4 объекта group.
- При создании массива координать для объекта Line, первые два элемента массива должны быть координатами line: {x:..., y:...}
- На объект canvas необходимо повесить слушатель перемещения объектов. Обновлять координаты нужной линии в соответсвии с новыми координатами "розеток - line" перемещенного объекта.

3. Удаление объектов, изменение их характеристик, сохранение состояния не реализовывал.
